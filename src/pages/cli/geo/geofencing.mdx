export const meta = {
  title: `Geofencing (Developer Preview)`,
  description: `Use Amplify CLI to create and manage collections of Geofences`,
};

Amplify's `geo` category enables you to create and manage collections of Geofences used to setup virtual geographic perimeters.

<Callout>

**Note:** The Amplify Geo Geofencing feature is in developer preview and is not intended to be used in production environments. Please reach out to us for any feedback and/or issues [here](https://github.com/aws-amplify/amplify-cli/issues)

</Callout>

## Install Amplify CLI
Since the Geofencing feature is a developer preview, you need to update your Amplify CLI to try it out:

```bash
npm i -g @aws-amplify/cli@geo
```

## Setup a new Geofence Collection
Before you add a new Geofence Collection to your application, you need to have at least one Cognito User Pool group added to your project.
The permissions to perform `CRUD` operations on Geofences in the collection will be granted only to users belonging to a Cognito User Pool group that is responsible for managing these Geofences.

If you haven't set up the `auth` category already, you can do so by running:
```bash
amplify add auth
```

When you have `auth` category set up, you can add the Cognito User Pool groups using:
```bash
amplify update auth
```
```console
? What do you want to do? 
  Apply default configuration with Social Provider (Federation) 
  Walkthrough all the auth configurations 
❯ Create or update Cognito user pool groups 
  Create or update Admin queries API 

? Provide a name for your user pool group: storesInWashingtonGeofenceCollectionAdmin

? Do you want to add another User Pool Group No

? Sort the user pool groups in order of preference
  storesInWashingtonGeofenceCollectionAdmin

```

When you have at least one Cognito User Pool group added, you can now provision a new Geofence Collection using:
```bash
amplify add geo
```
```console
? Select which capability you want to add: 
  Map (visualize the geospatial data) 
  Location search (search by places, addresses, coordinates) 
❯ Geofencing (visualize virtual perimeters)
```

Next, set a name for the Geofence Collection: 

```console
? Provide a name for the Geofence Collection: storesInWashington
```

## Geofence Collection Access permissions

Next, configure the access permissions for your geofence collection resource and authorize users of desired Cognito User Pool groups to perform `CRUD` operations on Geofences in the collection.

```console
? Select one or more cognito groups to give access:
✔ storesInWashingtonGeofenceCollectionAdmin

? What kind of access do you want for storesInWashingtonGeofenceCollectionAdmin users? Select ALL that apply:
 ✔ Read geofence
 ✔ Create/Update geofence
   Delete geofence
 ✔ List geofences
```

The above chosen permissions are granted to the users belonging the specified Cognito User Pool group. 
Please note that these permissions apply to ALL Geofences in a collection. For example, If you chose `Read geofence` permission for say `storesInWashingtonGeofenceCollectionAdmin`
Cognito group, ALL users added to that group will be able to read the properties of ALL Geofences in that Geofence collection.

## Geofence Collection Pricing Plan and Data Provider

Amazon Location Service offers three pricing plans namely, `RequestBasedUsage`, `MobileAssetTracking` and `MobileAssetManagement` that require no up-front commitment, and no minimum fee.
You select one of the following pricing plans for the Amazon Location Service resources you create for your application.
Amplify helps you determine the best pricing plan for you by guiding you through a set of questions.
These pricing plan related set of questions are presented to you when you add the first Geofence Collection resource to your application and can be updated later if needed. 
Once you chose the pricing plan, it will be automatically used for the ALL Geo resources added to your application.

We advice you to go through the [location service pricing](https://aws.amazon.com/location/pricing/) along with the [location service terms](https://aws.amazon.com/service-terms/) (_82.5 section_) to learn more about the pricing plan.

```console
The following choices will update the pricing plan for ALL Geo resources in the project.

? Are you tracking or directing commercial assets for your business in your app?
❯ No, I do not track or direct any assets
  No, I only need to track or direct consumers' personal mobile devices
  Yes, I track or direct commercial assets (For example, any mobile object that is tracked by a company in support of its business)
  Learn More

Successfully set RequestBasedUsage pricing plan for your Geo resources.
```

```console
The following choices will update the pricing plan for ALL Geo resources in the project.

? Are you tracking or directing commercial assets for your business in your app?
  No, I do not track or direct any assets
❯ No, I only need to track or direct consumers' personal mobile devices
  Yes, I track or direct commercial assets (For example, any mobile object that is tracked by a company in support of its business)
  Learn More

Successfully set RequestBasedUsage pricing plan for your Geo resources.
```

```console
The following choices will update the pricing plan for ALL Geo resources in the project.

? Are you tracking or directing commercial assets for your business in your app?
  No, I do not track or direct any assets
  No, I only need to track or direct consumers' personal mobile devices
❯ Yes, I track or direct commercial assets (For example, any mobile object that is tracked by a company in support of its business)
  Learn More

? Does your app need Maps, Location Search or Routing? (y/N) · yes

? Does your app provide routing or route optimization for commercial assets? (y/N) . no

Successfully set MobileAssetTracking pricing plan for your Geo resources.

? Specify the data provider for geofence collection. This will be only used to calculate billing.
❯ Esri
  HERE
```

```console
The following choices will update the pricing plan for ALL Geo resources in the project.

? Are you tracking or directing commercial assets for your business in your app?
  No, I do not track or direct any assets
  No, I only need to track or direct consumers' personal mobile devices
❯ Yes, I track or direct commercial assets (For example, any mobile object that is tracked by a company in support of its business)
  Learn More

? Does your app need Maps, Location Search or Routing? (y/N) · yes

? Does your app provide routing or route optimization for commercial assets? (y/N) . yes

Successfully set MobileAssetManagement pricing plan for your Geo resources.

? Specify the data provider for geofence collection. This will be only used to calculate billing.
❯ Esri
  HERE
```

```console
The following choices will update the pricing plan for ALL Geo resources in the project.

? Are you tracking or directing commercial assets for your business in your app?
  No, I do not track or direct any assets
  No, I only need to track or direct consumers' personal mobile devices
❯ Yes, I track or direct commercial assets (For example, any mobile object that is tracked by a company in support of its business)
  Learn More

? Does your app need Maps, Location Search or Routing? (y/N) · no

? Based on your use case, you may use any of the pricing plans. Select the pricing plan for ALL your Geo resources in the project. We recommend you start with 'Request Based Usage' and then consider one of the other pricing plans as your usage scales
❯ Request Based Usage
  Mobile Asset Tracking
  Mobile Asset Management
  Learn More

Successfully set RequestBasedUsage pricing plan for your Geo resources.
```

## Set a default Geofence Collection
If you added more than one geofence collection via `amplify add geo`, the geofence collection that was added last will be the default. 
However, you can choose if the current geofence collection should be the default for your application:

```console
? Set this geofence collection as the default? It will be used in Amplify geofence collection API calls if no explicit reference is provided. (Y/n)
> No
```
Answering `No` will retain the previously set default.

That's it! You can now create virtual perimeters around points of interest in your application. Follow the library documentation as listed [here](/lib/geo/getting-started).
